# 18.å¸ƒéš†è¿‡æ»¤å™¨çš„å®ç°åŠåº”ç”¨

## å¸ƒéš†è¿‡æ»¤å™¨ä»‹ç»
å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰ç”±Burton Howard Bloomåœ¨1970å¹´æå‡ºï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„**äºŒè¿›åˆ¶å‘é‡ï¼ˆä½æ•°ç»„ï¼‰** å’Œä¸€ç³»åˆ— **éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œï¼‰**ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œæ˜¯ä¸€ç§ç©ºé—´æŸ¥è¯¢ç‡é«˜çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½æ¯”ä¸€èˆ¬çš„ç®—æ³•è¦å¥½çš„å¤šï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚

å®ƒä¸“é—¨ç”¨æ¥æ£€æµ‹é›†åˆä¸­æ˜¯å¦å­˜åœ¨ç‰¹å®šçš„å…ƒç´ ã€‚åœ¨è¿™é‡Œå¬èµ·æ¥å¾ˆå¹³å¸¸çš„éœ€æ±‚ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆè¦ä½¿ç”¨è¿™ç§æ•°æ®ç»“æ„ï¼Ÿ

### ä»€ä¹ˆæƒ…å†µä¸‹éœ€è¦ç”¨åˆ°å¸ƒéš†è¿‡æ»¤å™¨ï¼Ÿ
æˆ‘ä»¬å…ˆæ¥çœ‹å‡ ä¸ªæ¯”è¾ƒå¸¸è§çš„ä¾‹å­ï¼š
- åœ¨å­—å¤„ç†è½¯ä»¶ä¸­ï¼Œéœ€è¦æ£€æŸ¥ä¸€ä¸ªè‹±è¯­å•è¯æ˜¯å¦æ‹¼å†™æ­£ç¡®ï¼›
- ç½‘é¡µçˆ¬è™«å¯¹URLå»é‡ï¼Œé¿å…çˆ¬å–ç›¸åŒçš„URLåœ°å€ï¼›
- ååƒåœ¾é‚®ä»¶ï¼Œä»æ•°åäº¿ä¸ªåƒåœ¾é‚®ä»¶åˆ—è¡¨ä¸­åˆ¤æ–­æŸé‚®ç®±æ˜¯å¦æ˜¯åƒåœ¾é‚®ç®±ï¼›
- ç¼“å­˜ç©¿é€ï¼Œå°†å·²ç»å­˜åœ¨çš„ç¼“å­˜æ”¾åœ¨å¸ƒéš†ä¸­ï¼Œå½“é»‘å®¢è®¿é—®ä¸å­˜åœ¨çš„ç¼“å­˜æ—¶è¿…é€Ÿè¿”å›é¿å…ç¼“å­˜åŠDBæŒ‚æ‰ã€‚

è¿™å‡ ä¸ªä¾‹å­æœ‰ä¸€ä¸ªå…±åŒçš„ç‰¹ç‚¹ï¼š**å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Ÿ**

**å¸¸è§„æ€è·¯ï¼š**
- æ•°ç»„
- é“¾è¡¨
- æ ‘ã€å¹³è¡¡äºŒå‰æ ‘ã€Trie(å­—å…¸æ ‘)
- Mapï¼ˆçº¢é»‘æ ‘ï¼‰
- å“ˆå¸Œè¡¨

> è™½ç„¶ä¸Šé¢æè¿°çš„è¿™å‡ ç§æ•°æ®ç»“æ„é…åˆå¸¸è§çš„æ’åºã€äºŒåˆ†æœç´¢å¯ä»¥å¿«é€Ÿé«˜æ•ˆçš„å¤„ç†ç»å¤§éƒ¨åˆ†åˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨é›†åˆä¸­çš„éœ€æ±‚ã€‚ä½†æ˜¯å½“é›†åˆé‡Œé¢çš„å…ƒç´ æ•°é‡è¶³å¤Ÿå¤§ï¼Œå¦‚æœæœ‰500Wæ¡è®°å½•ç”šè‡³1äº¿æ¡è®°å½•å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™å¸¸è§„çš„æ•°æ®ç»“æ„çš„é—®é¢˜å°±å‡¸æ˜¾å‡ºæ¥äº†ã€‚æ•°ç»„ã€é“¾è¡¨ã€æ ‘ç­‰æ•°æ®ç»“æ„å›å­˜å‚¨å…ƒç´ çš„å†…å®¹ï¼Œä¸€æ—¦æ•°æ®é‡è¿‡å¤§ï¼Œæ¶ˆè€—çš„å†…å­˜çº¦ä¼šå‘ˆç°çº¿æ€§å¢é•¿ï¼Œæœ€ç»ˆè¾¾åˆ°ç“¶é¢ˆã€‚

> æœ‰çš„åŒå­¦å¯èƒ½å›é—®ï¼Œå“ˆå¸Œè¡¨ä¸æ˜¯æ•ˆç‡å¾ˆé«˜å—ï¼ŸæŸ¥è¯¢æ•ˆç‡å¯ä»¥è¾¾åˆ°O(1)ã€‚ä½†æ˜¯å“ˆå¸Œè¡¨éœ€è¦æ¶ˆè€—çš„å†…å­˜ä¾ç„¶å¾ˆé«˜ã€‚ä½¿ç”¨å“ˆå¸Œè¡¨å­˜å‚¨1äº¿ä¸ªåƒåœ¾emailåœ°å€çš„æ¶ˆè€—ï¼Ÿå“ˆå¸Œè¡¨çš„åšæ³•ï¼šé¦–å…ˆï¼Œå“ˆå¸Œå‡½æ•°å°†ä¸€ä¸ªemailåœ°å€æ˜ å°„æˆ8å­—èŠ‚ä¿¡æ¯æŒ‡çº¹ï¼›è€ƒè™‘åˆ°å“ˆå¸Œè¡¨å­˜å‚¨æ•ˆç‡é€šå¸¸å°äº50%ï¼ˆå“ˆå¸Œå†²çªï¼‰ï¼›å› æ­¤æ¶ˆè€—çš„å†…å­˜ï¼š8 * 2 * 1äº¿ å­—èŠ‚ = 1.6Gå†…å­˜ï¼Œæ™®æŸ¥è®¡ç®—æœºæ˜¯æ— æ³•æä¾›å¦‚æ­¤å¤§çš„å†…å­˜ã€‚è¿™ä¸ªæ—¶å€™ï¼Œå¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰å°±åº”è¿è€Œç”Ÿã€‚

åœ¨ç†è§£å¸ƒéš†è¿‡æ»¤å™¨çš„åŸç†æ—¶ï¼Œå…ˆæ¥å›é¡¾ä¸€ä¸‹å“ˆå¸Œå‡½æ•°çš„çŸ¥è¯†ã€‚

**å“ˆå¸Œå‡½æ•°**

å“ˆå¸Œå‡½æ•°çš„æ¦‚å¿µæ˜¯ï¼šå°†ä»»æ„å¤§å°çš„æ•°æ®è½¬æ¢æˆç‰¹å®šå¤§å°çš„æ•°æ®çš„å‡½æ•°ï¼Œè½¬æ¢åçš„æ•°æ®ç§°ä¸ºå“ˆå¸Œå€¼æˆ–å“ˆå¸Œç¼–ç ã€‚

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/199603a1b5f44135be82f20f1798b74e~tplv-k3u1fbpfcp-zoom-1.image)

å¯¹äºå“ˆå¸Œè¡¨æ¥è¯´å®ƒä¸ä»…æœ‰å“ˆå¸Œå‡½æ•°æ¥å¾—åˆ°è¿™ä¹ˆä¸€ä¸ª`index`å€¼ï¼Œä¸”å®ƒä¼šæŠŠæ•´ä¸ªè¦å­˜çš„å…ƒç´ å…¨éƒ¨éƒ½æ”¾åˆ°å“ˆå¸Œè¡¨é‡Œé¢å–ï¼Œè¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰è¯¯å·®çš„æ•°æ®ç»“æ„ä¸”æœ‰å¤šå°‘çš„å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æœ‰å¤šå¤§ï¼Œé‚£ä¹ˆæ‰€æœ‰çš„è¿™äº›å…ƒç´ éœ€è¦å çš„å†…å­˜ç©ºé—´åœ¨å“ˆå¸Œè¡¨é‡Œé¢éƒ½è¦æ‰¾ç›¸åº”çš„å†…å­˜çš„å¤§å°ç»™å­˜è¿›æ¥ã€‚

é‚£ä¹ˆåœ¨å¾ˆå¤šæ—¶å€™æˆ‘ä»¬åœ¨å·¥ä¸šçº§åº”ç”¨çš„æ—¶å€™ï¼Œå‘ç°æˆ‘ä»¬å¹¶ä¸éœ€è¦å­˜æ‰€æœ‰å…ƒç´ æœ¬èº«ï¼Œè€Œåªéœ€è¦å­˜ä¸€ä¸ªä¿¡æ¯ï¼Œå°±æ˜¯è¯´è¿™ä¸ªå…ƒç´ åœ¨æˆ‘è¿™ä¸ªè¡¨é‡Œé¢åˆ°åº•æ˜¯æœ‰è¿˜æ˜¯æ²¡æœ‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹å¦‚æœåªè¦æŸ¥è¯¢æœ‰è¿˜æ˜¯æ²¡æœ‰çš„æ—¶å€™ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¸€ç§æ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„ï¼Œæ›´é«˜æ•ˆçš„æ•°æ®ç»“æ„å¯ä»¥å¯¼è‡´çš„ä¸€ä¸ªç»“æœï¼Œå°±è¿™é‡Œæœ‰å¾ˆå¤šå…ƒç´ è¦å­˜çš„è¯ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªè¡¨çš„è¯æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´å¾ˆå°‘ï¼ŒåŒæ—¶çš„è¯æˆ‘ä»¬ä¸éœ€è¦æŠŠå…ƒç´ æœ¬èº«å…¨éƒ¨å­˜èµ·æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦è¯´æŠŠè¿™ä¸ªä¸œè¥¿åˆ°åº•æ˜¯æœ‰è¿˜æ˜¯æ²¡æœ‰ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹è¿™ä¸ªæ•°æ®ç»“æ„åˆ°åº•æ˜¯æ€ä¹ˆè®¾è®¡å‡ºæ¥çš„ã€‚

### å¸ƒéš†è¿‡æ»¤å™¨åŸç†
å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰çš„æ ¸å¿ƒå®ç°æ˜¯ä¸€ä¸ªè¶…å¤§çš„**ä½æ•°ç»„**å’Œ**å‡ ä¸ªå“ˆå¸Œå‡½æ•°**ã€‚å‡è®¾ä½æ•°ç»„çš„é•¿åº¦ä¸º `m`ï¼Œå“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ä¸º`k`ã€‚

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/07ce9cf1a75f442b9fa0e95ccd3ad4af~tplv-k3u1fbpfcp-zoom-1.image)

å…·ä½“çš„æ“ä½œæµç¨‹ï¼šå‡è®¾é›†åˆé‡Œé¢æœ‰3ä¸ªå…ƒç´  `{x,y,z}`, å“ˆå¸Œå‡½æ•°çš„ä¸ªæ•°ä¸º3ã€‚
- é¦–å…ˆå°†ä½æ•°ç»„è¿›è¡Œåˆå§‹åŒ–ï¼Œå°†é‡Œé¢æ¯ä¸ªä½éƒ½è®¾ç½®ä¸º0ã€‚
- å¯¹äºé›†åˆé‡Œé¢çš„æ¯ä¸ªå…ƒç´ ï¼Œå°†å…ƒç´ ä¾æ¬¡é€šè¿‡3ä¸ªå“ˆå¸Œå‡½æ•°è¿›è¡Œæ˜ å°„ï¼Œæ¯æ¬¡æ˜ å°„éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œè¿™ä¸ªå€¼å¯¹åº”ä½æ•°ç»„ä¸Šé¢çš„ä¸€ä¸ªç‚¹ï¼Œç„¶åå°†ä½æ•°ç»„å¯¹åº”çš„ä½ç½®æ ‡è®°ä½1ã€‚
- æŸ¥è¯¢ `W` å…ƒç´ æ˜¯å¦å­˜åœ¨é›†åˆä¸­çš„æ—¶å€™ï¼ŒåŒæ ·çš„æ–¹æ³•å°†Wé€šè¿‡å“ˆå¸Œè¡¨æ˜ å°„åˆ°ä½æ•°ç»„ä¸Šçš„3ä¸ªç‚¹ã€‚å¦‚æœ3ä¸ªç‚¹çš„å…¶ä¸­æœ‰ä¸€ä¸ªç‚¹ä¸ä¸º1ï¼Œåˆ™å¯ä»¥åˆ¤æ–­è¯¥å…ƒç´ ä¸€å®šä¸å­˜åœ¨é›†åˆä¸­ã€‚åä¹‹ï¼Œå¦‚æœ3ä¸ªç‚¹éƒ½ä¸º1ï¼Œåˆ™è¯¥å…ƒç´ å¯èƒ½å­˜åœ¨é›†åˆä¸­ã€‚

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ba7ad2ef8c9f41b0bc9ad5d161c165fa~tplv-k3u1fbpfcp-zoom-1.image)

> æ³¨æ„ï¼šæ­¤å¤„ä¸èƒ½åˆ¤æ–­è¯¥å…ƒç´ æ˜¯å¦ä¸€å®šå­˜åœ¨é›†åˆä¸­ï¼Œå¯èƒ½å­˜åœ¨ä¸€å®šçš„è¯¯åˆ¤ç‡ã€‚å¯ä»¥ä»å›¾ä¸­çœ‹åˆ°ï¼šå‡è®¾æŸä¸ªå…ƒç´ é€šè¿‡æ˜ å°„å¯¹åº”ä¸‹æ ‡ä¸º4ï¼Œ5ï¼Œ6è¿™3ä¸ªç‚¹ã€‚è™½ç„¶è¿™3ä¸ªç‚¹éƒ½ä¸º1ï¼Œä½†æ˜¯å¾ˆæ˜æ˜¾è¿™3ä¸ªç‚¹æ˜¯ä¸åŒå…ƒç´ ç»è¿‡å“ˆå¸Œè¡¨å¾—åˆ°çš„ä½ç½®ï¼Œå› æ­¤è¿™ç§æƒ…å†µè¯´æ˜å…ƒç´ è™½ç„¶ä¸åœ¨é›†åˆä¸­ï¼Œä¹Ÿå¯èƒ½å¯¹åº”çš„éƒ½æ˜¯1ï¼Œè¿™å°±æ˜¯è¯¯åˆ¤ç‡å­˜åœ¨çš„åŸå› ã€‚

### **å¸ƒéš†è¿‡æ»¤å™¨çš„è®¾è®¡**

å¸ƒéš†è¿‡æ»¤å™¨æ€è·¯æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å¯¹äºå¸ƒéš†è¿‡æ»¤å™¨çš„éšæœºæ˜ å°„å‡½æ•°è®¾è®¡ï¼Œéœ€è¦è®¡ç®—å‡ æ¬¡ï¼Œå‘é‡é•¿åº¦è®¾ç½®å¤šå°‘æ¯”è¾ƒåˆé€‚ï¼Œè¿™ä¸ªæ‰æ˜¯éœ€è¦è®¤çœŸè®¨è®ºçš„ã€‚
- å¦‚æœå‘é‡é•¿åº¦å¤ªçŸ­ï¼Œä¼šå¯¼è‡´è¯¯åˆ¤ç‡ç›´çº¿ä¸Šå‡ã€‚
- å¦‚æœå‘é‡å¤ªé•¿ï¼Œä¼šæµªè´¹å¤§é‡å†…å­˜ã€‚
- å¦‚æœè®¡ç®—æ¬¡æ•°è¿‡å¤šï¼Œä¼šå ç”¨è®¡ç®—èµ„æºï¼Œä¸”å¾ˆå®¹æ˜“å¾ˆå¿«å°±æŠŠè¿‡æ»¤å™¨å¡«æ»¡ã€‚

### å¸ƒéš†è¿‡æ»¤å™¨çš„ç®€å•å®ç°

**å¸ƒéš†è¿‡æ»¤å™¨æ·»åŠ å…ƒç´ **
- å°†è¦æ·»åŠ çš„å…ƒç´ ç»™kä¸ªå“ˆå¸Œå‡½æ•°
- å¾—åˆ°å¯¹åº”äºä½æ•°ç»„ä¸Šçš„kä¸ªä½ç½®
- å°†è¿™kä¸ªä½ç½®è®¾ä¸º1

**å¸ƒéš†è¿‡æ»¤å™¨æŸ¥è¯¢å…ƒç´ **
- å°†è¦æŸ¥è¯¢çš„å…ƒç´ ç»™kä¸ªå“ˆå¸Œå‡½æ•°
- å¾—åˆ°å¯¹åº”äºä½æ•°ç»„ä¸Šçš„kä¸ªä½ç½®
- å¦‚æœkä¸ªä½ç½®æœ‰ä¸€ä¸ªä¸º0ï¼Œåˆ™è‚¯å®šä¸åœ¨é›†åˆä¸­
- å¦‚æœkä¸ªä½ç½®å…¨éƒ¨ä¸º1ï¼Œåˆ™å¯èƒ½åœ¨é›†åˆä¸­

**javaå®ç°**
```
//Java
public class BloomFilter {
    private static final int DEFAULT_SIZE = 2 << 24;
    private static final int[] seeds = new int[] { 5, 7, 11, 13, 31, 37, 61 };
    private BitSet bits = new BitSet(DEFAULT_SIZE);
    private SimpleHash[] func = new SimpleHash[seeds.length];
    public BloomFilter() {
        for (int i = 0; i < seeds.length; i++) {
            func[i] = new SimpleHash(DEFAULT_SIZE, seeds[i]);
        }
    }
    public void add(String value) {
        for (SimpleHash f : func) {
            bits.set(f.hash(value), true);
        }
    }
    public boolean contains(String value) {
        if (value == null) {
            return false;
        }
        boolean ret = true;
        for (SimpleHash f : func) {
            ret = ret && bits.get(f.hash(value));
        }
        return ret;
    }
    // å†…éƒ¨ç±»ï¼ŒsimpleHash
    public static class SimpleHash {
        private int cap;
        private int seed;
        public SimpleHash(int cap, int seed) {
            this.cap = cap;
            this.seed = seed;
        }
        public int hash(String value) {
            int result = 0;
            int len = value.length();
            for (int i = 0; i < len; i++) {
                result = seed * result + value.charAt(i);
            }
            return (cap - 1) & result;
        }
    }
}
```

**Pythonå®ç°**
```
# Python 
from bitarray import bitarray 
import mmh3 
class BloomFilter: 
	def __init__(self, size, hash_num): 
		self.size = size 
		self.hash_num = hash_num 
		self.bit_array = bitarray(size) 
		self.bit_array.setall(0) 
	def add(self, s): 
		for seed in range(self.hash_num): 
			result = mmh3.hash(s, seed) % self.size 
			self.bit_array[result] = 1 
	def lookup(self, s): 
		for seed in range(self.hash_num): 
			result = mmh3.hash(s, seed) % self.size 
			if self.bit_array[result] == 0: 
				return "Nope" 
		return "Probably" 
bf = BloomFilter(500000, 7) 
bf.add("dantezhao") 
print (bf.lookup("dantezhao")) 
print (bf.lookup("yyj")) 
```

**C/C++å®ç°**
```
C/C++

#include <iostream>
#include <bitset>
#include <cmath>
 
using namespace std;

typedef unsigned int uint; 
const int DEFAULT_SIZE = 1 << 20;
const int seed[] = { 5, 7, 11, 13, 31, 37, 61 };


class BloomFilter {
public:
	BloomFilter() : hash_func_count(3) {}
    BloomFilter(int bitsize, int str_count) { 
    	hash_func_count = ceil((bitsize / str_count) * log(2));
	}
    ~BloomFilter() {}
	
	uint RSHash(const char *str, int seed);
	void Add(const char *str);
	bool LookUp(const char *str);
 
private:
	int hash_func_count;
	bitset<DEFAULT_SIZE> bits;
};

uint BloomFilter::RSHash(const char *str, int seed) {  
    uint base = 63689;
    uint hash = 0;    
     
    while (*str) {    
        hash = hash * base + (*str++);    
        base *= seed;    
    }    
     
    return (hash & 0x7FFFFFFF);    
}    
 
void BloomFilter::Add(const char* str) {
	int index = 0;
	for(int i = 0; i < hash_func_count; ++i) {
		index = static_cast<int>(RSHash(str, seed[i])) % DEFAULT_SIZE;
		bits[index] = 1;
	}
	
	return ;
}
 
bool BloomFilter::LookUp(const char* str) {
	int index = 0;
	for(int i = 0; i < hash_func_count; ++i) {
		index = static_cast<int>(RSHash(str, seed[i])) % DEFAULT_SIZE;
		if (!bits[index]) return false; 
	}
 
	return true;
}
```

**javascriptå®ç°**
```
// JavaScript
class BloomFilter {
  constructor(maxKeys, errorRate) {
    this.bitMap = [];
    this.maxKeys = maxKeys;
    this.errorRate = errorRate;
    // ä½å›¾å˜é‡çš„é•¿åº¦ï¼Œéœ€è¦æ ¹æ®maxKeyså’ŒerrorRateæ¥è®¡ç®—
    this.bitSize = Math.ceil(maxKeys * (-Math.log(errorRate) / (Math.log(2) * Math.log(2))));
    // å“ˆå¸Œæ•°é‡
    this.hashCount = Math.ceil(Math.log(2) * (this.bitSize / maxKeys));
    // å·²åŠ å…¥å…ƒç´ æ•°é‡
    this.keyCount = 0;
  }

  bitSet(bit) {
    let numArr = Math.floor(bit / 31);
    let numBit = Math.floor(bit % 31);
    this.bitMap[numArr] |= 1 << numBit;
  }

  bitGet(bit) {
    let numArr = Math.floor(bit / 31);
    let numBit = Math.floor(bit % 31);
    return (this.bitMap[numArr] &= 1 << numBit);
  }

  add(key) {
    if (this.contain(key)) {
      return -1;
    }

    let hash1 = MurmurHash(key, 0, 0),
      hash2 = MurmurHash(key, 0, hash1);

    for (let i = 0; i < this.hashCount; i++) {
      this.bitSet(Math.abs(Math.floor((hash1 + i * hash2) % this.bitSize)));
    }

    this.keyCount++;
  }

  contain(key) {
    let hash1 = MurmurHash(key, 0, 0);
    let hash2 = MurmurHash(key, 0, hash1);

    for (let i = 0; i < this.hashCount; i++) {
      if (!this.bitGet(Math.abs(Math.floor((hash1 + i * hash2) % this.bitSize)))) {
        return false;
      }
    }

    return true;
  }
}


/**
 * MurmurHash
 *
 * å‚è€ƒ http://murmurhash.googlepages.com/
 *
 * dataï¼šå¾…å“ˆå¸Œçš„å€¼
 * offsetï¼š
 * seedï¼šç§å­é›†
 *
 */
function MurmurHash(data, offset, seed) {
  let len = data.length,
    m = 0x5bd1e995,
    r = 24,
    h = seed ^ len,
    len_4 = len >> 2;

  for (let i = 0; i < len_4; i++) {
    let i_4 = (i << 2) + offset,
      k = data[i_4 + 3];

    k = k << 8;
    k = k | (data[i_4 + 2] & 0xff);
    k = k << 8;
    k = k | (data[i_4 + 1] & 0xff);
    k = k << 8;
    k = k | (data[i_4 + 0] & 0xff);
    k *= m;
    k ^= k >>> r;
    k *= m;
    h *= m;
    h ^= k;
  }

  // avoid calculating modulo
  let len_m = len_4 << 2,
    left = len - len_m,
    i_m = len_m + offset;

  if (left != 0) {
    if (left >= 3) {
      h ^= data[i_m + 2] << 16;
    }
    if (left >= 2) {
      h ^= data[i_m + 1] << 8;
    }
    if (left >= 1) {
      h ^= data[i_m];
    }

    h *= m;
  }

  h ^= h >>> 13;
  h *= m;
  h ^= h >>> 15;
  
  return h;
}


let bloomFilter = new BloomFilter(10000, 0.01);

bloomFilter.add("abcdefgh");
console.log(bloomFilter.contain("abcdefgh"));
console.log(bloomFilter.contain("abcdefghi"));
```

### **é™„ï¼šå…¶å®ƒå®ç°**
- [å¸ƒéš†è¿‡æ»¤å™¨ Python å®ç°ç¤ºä¾‹](https://www.geeksforgeeks.org/bloom-filters-introduction-and-python-implementation/)
- [é«˜æ€§èƒ½å¸ƒéš†è¿‡æ»¤å™¨ Python å®ç°ç¤ºä¾‹](https://github.com/jhgg/pybloof)
- [å¸ƒéš†è¿‡æ»¤å™¨ Java å®ç°ç¤ºä¾‹ 1](https://github.com/lovasoa/bloomfilter/blob/master/src/main/java/BloomFilter.java)
- [å¸ƒéš†è¿‡æ»¤å™¨ Java å®ç°ç¤ºä¾‹ 2](https://github.com/Baqend/Orestes-Bloomfilter)

### **å¸¸è§æ¡ˆä¾‹**
1. æ¯”ç‰¹å¸ç½‘ç»œ
2. åˆ†å¸ƒå¼ç³»ç»Ÿ(Map-Reduce) â€” Hadoopã€search engine
3. Redis ç¼“å­˜
4. åƒåœ¾é‚®ä»¶ã€è¯„è®ºç­‰çš„è¿‡æ»¤


å‚è€ƒæ–‡ç« ï¼š[ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨è§£å†³ç¼“å­˜å‡»ç©¿ã€åƒåœ¾é‚®ä»¶è¯†åˆ«ã€é›†åˆåˆ¤é‡](https://blog.csdn.net/tianyaleixiaowu/article/details/74721877)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fe0e9ba5e718490ea49950590dda1491~tplv-k3u1fbpfcp-zoom-1.image)



    éƒ¨åˆ†å›¾ç‰‡æ¥æºäºç½‘ç»œï¼Œç‰ˆæƒå½’åŸä½œè€…ï¼Œä¾µåˆ ã€‚

    ğŸ‘‡ç‚¹å‡»é˜…è¯»åŸæ–‡ï¼ŒæŸ¥çœ‹å¾€æœŸå†…å®¹ï¼

                          å¿«ç•™è¨€ğŸ‘‡å’Œæˆ‘äº’åŠ¨å§ï½